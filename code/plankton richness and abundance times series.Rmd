---
title: "plankton richness and abundance time series"
author: "Madhumita Kabade"
date: "2025-08-24"
output: html_document
Description: This project explores temporal patterns in zooplankton and phytoplankton
  communities across multiple coastal sites. The focus is on tracking changes
  in plankton richness (number of taxa) and abundance (total counts) over time,
  and comparing these patterns between regions. By visualising and analysing
  date-by-date time series, the project aims to identify seasonal peaks and lows,
  evaluate spatial differences between sites, and provide a foundation for
  further comparisons with water quality variables such as nutrients, turbidity,
  temperature, and salinity.
---

####loading packages

```{r}
library(readxl)    # to read Excel files
library(dplyr)     # for data wrangling
library(janitor)   # for cleaning column names
library(lubridate) # for handling dates
```

####loading data files

```{r}
# Define file paths (relative to project root)
zoop_file  <- "data/NQBP zooplankton 2021-02-15.xlsx"
phyto_file <- "data/NQBP phytoplankton 2021-02-18.xlsx"

# Import sheets
zoop_raw <- read_excel(zoop_file, sheet = "in") |> clean_names()
phyto_raw <- read_excel(phyto_file, sheet = "in") |> clean_names()

# Quick peek
head(zoop_raw)
head(phyto_raw)
```

####setting the scene,prepping for the data frame

```{r}
# Ensure Date type
zoop <- zoop_raw |> dplyr::mutate(sample_date = as.Date(sample_date))
phyto <- phyto_raw |> dplyr::mutate(sample_date = as.Date(sample_date))

# Add region if missing (edit mapping if yours differ)
add_region <- function(df){
  has_region <- "region" %in% names(df)
  if (has_region) return(df)
  df |>
    dplyr::mutate(
      site_code = dplyr::coalesce(site_code, site_name),
      region_code = stringr::str_extract(site_code, "^[A-Za-z]{3}"),
      region = dplyr::case_when(
        region_code %in% c("MKY") ~ "Mackay",
        region_code %in% c("BWN") ~ "Bowen",
        region_code %in% c("WEI","WEP") ~ "Weipa",
        TRUE ~ "Unknown"
      )
    ) |>
    dplyr::select(-region_code)
}
zoop <- add_region(zoop)
phyto <- add_region(phyto)
```

####quick checks

```{r}
# Check types
str(zoop$sample_date); str(phyto$sample_date)

# Peek at the mapping results
# Zooplankton: include site_name
dplyr::count(zoop, site_code, site_name, region, sort = TRUE)

# Phytoplankton: include site_name
dplyr::count(phyto, site_code, site_name, region, sort = TRUE)

# See if anything fell into "Unknown"
dplyr::count(zoop, region)
dplyr::count(phyto, region)

# Earliest/latest sampling dates (helps set plot x-limits)
range(zoop$sample_date, na.rm = TRUE)
range(phyto$sample_date, na.rm = TRUE)

# Any missing dates?
sum(is.na(zoop$sample_date))
sum(is.na(phyto$sample_date))

```

####loading packages for analysis

```{r}
# Data wrangling + plotting
library(dplyr)
library(ggplot2)
library(readr)   # for write_csv()

```

####building summary tables fpr zooplankton and phytoplankton - abundance and richness

```{r}
# Abundance: sum of counts (orgs) per date/site/region
zoop_abund_daily <- zoop |>
  dplyr::group_by(sample_date, site_code, region) |>
  dplyr::summarise(
    zoop_total = sum(as.numeric(orgs), na.rm = TRUE),
    .groups = "drop"
  )

# Richness: number of distinct taxa per date/site/region
zoop_rich_daily <- zoop |>
  dplyr::filter(!is.na(taxa) & taxa != "") |>
  dplyr::group_by(sample_date, site_code, region) |>
  dplyr::summarise(
    zoop_richness = dplyr::n_distinct(taxa),
    .groups = "drop"
  )

# Join abundance + richness; order for tidy viewing
zoop_daily <- dplyr::full_join(
  zoop_abund_daily, zoop_rich_daily,
  by = c("sample_date","site_code","region")
) |>
  dplyr::arrange(site_code, sample_date)    

# ---- PHYTOPLANKTON ----

# Abundance: sum of cell_count per date/site/region
phyto_abund_daily <- phyto |>
  dplyr::group_by(sample_date, site_code, region) |>
  dplyr::summarise(
    phyto_total = sum(as.numeric(cell_count), na.rm = TRUE),
    .groups = "drop"
  )

# Richness: number of distinct taxa per date/site/region
phyto_rich_daily <- phyto |>
  dplyr::filter(!is.na(taxa) & taxa != "") |>
  dplyr::group_by(sample_date, site_code, region) |>
  dplyr::summarise(
    phyto_richness = dplyr::n_distinct(taxa),
    .groups = "drop"
  )

# Join abundance + richness; order for tidy viewing
phyto_daily <- dplyr::full_join(
  phyto_abund_daily, phyto_rich_daily,
  by = c("sample_date","site_code","region")
) |>
  dplyr::arrange(site_code, sample_date)

#saving the output summary tables
readr::write_csv(zoop_daily,  "output/zooplankton_daily_abund_rich.csv")
readr::write_csv(phyto_daily, "output/phytoplankton_daily_abund_rich.csv")


```

####debugging why output file isnt saving

```{r}
# Make sure the main output folder exists
if(!dir.exists("../output")) dir.create("../output")

# Move files from code/output → output
file.rename("output/zooplankton_daily_abund_rich.csv", 
            "../output/zooplankton_daily_abund_rich.csv")

file.rename("output/phytoplankton_daily_abund_rich.csv", 
            "../output/phytoplankton_daily_abund_rich.csv")
```

####checking if any data rows were lost when summary tables were formed

```{r}
# Original row counts
nrow(zoop_raw)
nrow(phyto_raw)

# Summarised row counts (unique date × site × region combos)
nrow(zoop_daily)
nrow(phyto_daily)

# How many unique sampling events were in the raw data?
n_distinct(zoop_raw$sample_date)
n_distinct(phyto_raw$sample_date)

# Total abundance in raw vs. summarised
sum(as.numeric(zoop_raw$orgs), na.rm = TRUE)
sum(zoop_daily$zoop_total, na.rm = TRUE)

sum(as.numeric(phyto_raw$cell_count), na.rm = TRUE)
sum(phyto_daily$phyto_total, na.rm = TRUE)

# recompute richness from raw for every site/date
check_rich <- zoop_raw |>
  group_by(site_code, sample_date) |>
  summarise(raw_rich = n_distinct(taxa), .groups = "drop")

# join with your summary table
compare <- left_join(check_rich, zoop_daily,
                     by = c("site_code","sample_date"))

# any site/date where richness differs?
compare |> filter(raw_rich != zoop_richness)

# site-date combos present in raw but missing in summary
anti_join(check_rich, zoop_daily, by = c("site_code","sample_date"))

## 2) Recompute richness from raw for every site × date
phyto_check_rich <- phyto_raw |>
  group_by(site_code, sample_date) |>
  summarise(raw_rich = n_distinct(taxa), .groups = "drop")

## 3) Compare raw-recomputed richness to your summarised table
phyto_compare <- left_join(
  phyto_check_rich,
  phyto_daily,                     # has phyto_richness
  by = c("site_code", "sample_date")
)

# Any mismatches?
phyto_compare |> filter(raw_rich != phyto_richness)
# Expect: 0 rows

## 4) Coverage: any site × date in raw missing from summary?
anti_join(phyto_check_rich, phyto_daily, by = c("site_code","sample_date"))
# Expect: 0 rows

```

####sorting both the tables from highest count to lowest count

```{r}
library(dplyr)

# ---- Phytoplankton sorted ----
# By abundance (highest first)
phyto_daily_abund_sorted <- phyto_daily %>%
  arrange(desc(phyto_total))

# By richness (highest first)
phyto_daily_rich_sorted <- phyto_daily %>%
  arrange(desc(phyto_richness))

# ---- Zooplankton sorted ----
# By abundance (highest first)
zoop_daily_abund_sorted <- zoop_daily %>%
  arrange(desc(zoop_total))

# By richness (highest first)
zoop_daily_rich_sorted <- zoop_daily %>%
  arrange(desc(zoop_richness))

# Peek at top 10 rows of each
head(phyto_daily_abund_sorted, 10)
head(phyto_daily_rich_sorted, 10)
head(zoop_daily_abund_sorted, 10)
head(zoop_daily_rich_sorted, 10)

# ---- Update phyto_daily ----
phyto_daily <- phyto_daily %>%
  arrange(desc(phyto_total), desc(phyto_richness))

# ---- Update zoop_daily ----
zoop_daily <- zoop_daily %>%
  arrange(desc(zoop_total), desc(zoop_richness))

```

####making region level tables, for region based analysis

```{r}
library(dplyr)
library(ggplot2)
library(lubridate)   # for floor_date / ceiling_date

# ---------- REGION-DAILY TABLES (as you had) ----------
# ZOOP
zoop_region_abund <- zoop %>%
  group_by(sample_date, region) %>%
  summarise(zoop_total = sum(as.numeric(orgs), na.rm = TRUE), .groups = "drop")

zoop_region_rich <- zoop %>%
  filter(!is.na(taxa) & taxa != "") %>%
  group_by(sample_date, region) %>%
  summarise(zoop_richness = n_distinct(taxa), .groups = "drop")

zoop_region_daily <- full_join(
  zoop_region_abund, zoop_region_rich,
  by = c("sample_date","region")
) %>% arrange(region, sample_date)

# PHYTO
phyto_region_abund <- phyto %>%
  group_by(sample_date, region) %>%
  summarise(phyto_total = sum(as.numeric(cell_count), na.rm = TRUE), .groups = "drop")

phyto_region_rich <- phyto %>%
  filter(!is.na(taxa) & taxa != "") %>%
  group_by(sample_date, region) %>%
  summarise(phyto_richness = n_distinct(taxa), .groups = "drop")

phyto_region_daily <- full_join(
  phyto_region_abund, phyto_region_rich,
  by = c("sample_date","region")
) %>% arrange(region, sample_date)

# ---------- CONSISTENT X-AXIS (3-month ticks, same limits for all plots) ----------
x_min <- min(c(zoop_region_daily$sample_date,  phyto_region_daily$sample_date), na.rm = TRUE)
x_max <- max(c(zoop_region_daily$sample_date,  phyto_region_daily$sample_date), na.rm = TRUE)

# snap limits nicely to quarter starts/ends
x_lim_min <- floor_date(x_min, "quarter")
x_lim_max <- ceiling_date(x_max, "quarter")

x_scale <- scale_x_date(
  limits      = c(x_lim_min, x_lim_max),
  breaks      = seq(x_lim_min, x_lim_max, by = "3 months"),  # Jan/Apr/Jul/Oct pattern
  date_labels = "%Y-%m",
  expand      = c(0.01, 0.01)
)

common_theme <- theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# ---------- PLOTS ----------
# 1) Zooplankton abundance (by region)
p1 <- ggplot(zoop_region_daily, aes(sample_date, zoop_total, color = region)) +
  geom_line() + geom_point(size = 0.8) +
  labs(title = "Zooplankton abundance over time (by region)",
       x = "Date", y = "Total zooplankton") +
        scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m")+ 
  x_scale + common_theme

# 2) Zooplankton richness (by region)
p2 <- ggplot(zoop_region_daily, aes(sample_date, zoop_richness, color = region)) +
  geom_line() + geom_point(size = 0.8) +
  labs(title = "Zooplankton richness over time (by region)",
       x = "Date", y = "Number of taxa") +
        scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m")+ 
  x_scale + common_theme

# 3) Phytoplankton abundance (by region)
p3 <- ggplot(phyto_region_daily, aes(sample_date, phyto_total, color = region)) +
  geom_line() + geom_point(size = 0.8) +
  labs(title = "Phytoplankton abundance over time (by region)",
       x = "Date", y = "Total phytoplankton (cells)") +
        scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m")+ 
  x_scale + common_theme

# 4) Phytoplankton richness (by region)
p4 <- ggplot(phyto_region_daily, aes(sample_date, phyto_richness, color = region)) +
  geom_line() + geom_point(size = 0.8) +
  labs(title = "Phytoplankton richness over time (by region)",
       x = "Date", y = "Number of taxa") +
        scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m")+ 
  x_scale + common_theme

# print
p1; p2; p3; p4


```

####code for zooplankton sampling effort

```{r}
# Zooplankton sampling effort (count per region per date)
zoop_sampling <- zoop %>%
  dplyr::count(sample_date, region, name = "n_samples")

# ---- Zooplankton sampling effort ----
ggplot(zoop_sampling, aes(x = sample_date, y = n_samples, color = region)) +
  geom_line() + geom_point(size = 0.8) +
  labs(title = "Zooplankton sampling effort (by region)",
       x = "Date", y = "Number of samples") +
        scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m")+ 
  scale_x_date(
    date_breaks = "3 months",   # every 3 months
    date_labels = "%Y-%m"       # format like 2018-01, 2018-04, etc
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

####code for phytoplankton sampling effort

```{r}
# Phytoplankton sampling effort (count per region per date)
phyto_sampling <- phyto %>%
  dplyr::count(sample_date, region, name = "n_samples")

ggplot(phyto_sampling, aes(x = sample_date, y = n_samples, color = region)) +
  geom_line() + geom_point(size = 0.8) +
  labs(title = "Phytoplankton sampling effort (by region)",
       x = "Date", y = "Number of samples") +
  scale_x_date(
    date_breaks = "3 months",   
    date_labels = "%Y-%m"       
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

####site wise time series comparisons

```{r}
# install once if needed:
# install.packages("ggforce")

library(dplyr)
library(ggplot2)
library(ggforce)

plot_sites <- function(df, region_pick, yvar, ylab, title,
                       ncol = 4, nrow = 3, page = 1) {

  df %>%
    filter(region == region_pick) %>%
    ggplot(aes(x = sample_date, y = .data[[yvar]])) +
    geom_line(linewidth = 0.4, alpha = 0.8) +
    geom_point(size = 1.2, alpha = 0.9) +
    facet_wrap_paginate(~ site_code, ncol = ncol, nrow = nrow, page = page) +
    scale_x_date(date_breaks = "3 months", date_labels = "%Y-%m") +
    labs(title = paste0(title, " — ", region_pick),
         x = "Date", y = ylab) +
          scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
    theme_minimal(base_size = 11) +
    theme(
      panel.grid.minor = element_blank(),
      axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
      strip.text = element_text(face = "bold")
    )
}


# ===================== ZOOPLANKTON =====================

# Abundance by site, per region
plot_sites(zoop_daily, "Bowen",  "zoop_total",     "Total zooplankton",            "Zooplankton abundance by site", page = 1)
plot_sites(zoop_daily, "Mackay", "zoop_total",     "Total zooplankton",            "Zooplankton abundance by site", page = 1)
plot_sites(zoop_daily, "Weipa",  "zoop_total",     "Total zooplankton",            "Zooplankton abundance by site", page = 1)

# Richness by site, per region
plot_sites(zoop_daily, "Bowen",  "zoop_richness",  "Zooplankton taxa richness",    "Zooplankton richness by site", page = 1)
plot_sites(zoop_daily, "Mackay", "zoop_richness",  "Zooplankton taxa richness",    "Zooplankton richness by site", page = 1)
plot_sites(zoop_daily, "Weipa",  "zoop_richness",  "Zooplankton taxa richness",    "Zooplankton richness by site", page = 1)

# ===================== PHYTOPLANKTON =====================

# Abundance by site, per region
plot_sites(phyto_daily, "Bowen",  "phyto_total",    "Total phytoplankton (cells)",  "Phytoplankton abundance by site", page = 1)
plot_sites(phyto_daily, "Mackay", "phyto_total",    "Total phytoplankton (cells)",  "Phytoplankton abundance by site", page = 1)
plot_sites(phyto_daily, "Weipa",  "phyto_total",    "Total phytoplankton (cells)",  "Phytoplankton abundance by site", page = 1)

# Richness by site, per region
plot_sites(phyto_daily, "Bowen",  "phyto_richness", "Phytoplankton taxa richness",  "Phytoplankton richness by site", page = 1)
plot_sites(phyto_daily, "Mackay", "phyto_richness", "Phytoplankton taxa richness",  "Phytoplankton richness by site", page = 1)
plot_sites(phyto_daily, "Weipa",  "phyto_richness", "Phytoplankton taxa richness",  "Phytoplankton richness by site", page = 1)

```

#lets move on to making chategories of zooplankton and phytoplankton species

# Listing all the unique taxa in the taxa column for zoop and phyto

```{r}
library(dplyr)

unique_taxa_zoop <- zoop |>
  distinct(taxa) |>        # keeps only unique taxa names
  arrange(taxa, .by_group = FALSE) |>        # sorts alphabetical(optional)
  pull(taxa)                # extracts as a vector

write.csv(unique_taxa_zoop, "data/unique_taxa_list.csv", row.names = FALSE)


```

# Adding functional group column to the dataset(first go)

```{r}
library(dplyr)

zoop_fg <- zoop |>
  mutate(
    functional_group = case_when(
      # 1. Copepods
      taxa %in% c(
        "Acartia pacifica", "Acrocalanus gibber", "Calanopia elliptica",
        "Centropages furcatus", "Farranula sp", "Farranula spp",
        "Microsetella rosea", "Oncaea venusta", "Oithona sp",
        "Pseudevadne sp", "Evadne spp"
      ) ~ "Copepods",

      # 2. Other Crustaceans
      taxa %in% c(
        "Portunidae", "Penaeus spp", "Penaeus sp",
        "Porcellanidae sp", "Porcellanidae spp",
        "Gammaridea", "Isopoda",
        "Caprella sp", "Caprella spp",
        "Bathyporeia sp", "Bathyporeia spp",
        "Stomatopoda", "Astacidea", "Panulirus sp",
        "Thecostraca", "Lucifer penicillifer"
      ) ~ "Other Crustaceans",

      # 3. Gelatinous Zooplankton
      taxa %in% c(
        "Salpa sp", "Salpa spp", "Thalia sp",
        "Bolinopsis sp", "Doliolum sp", "Siphonophorae"
      ) ~ "Gelatinous Zooplankton",

      # 4. Larval Forms
      taxa %in% c(
        "Larval fish & eggs", "Polychaete", "Polychaeta",
        "Polycheate", "Cnidarian larvae", "Echinoidea", "Cephalapoda"
      ) ~ "Larval Forms",

      # 5. Protists (Microzooplankton)
      taxa %in% c(
        "Acanthometra sp", "Acanthometra spp",
        "Dictyocysta sp", "Dictyocysta spp",
        "Favella serrata",
        "Tintinnopsis sp", "Tintinnopsis spp"
      ) ~ "Protists (Microzooplankton)",

      # 6. Molluscs & Others
      taxa %in% c(
        "Gastropoda", "Oikopleura dioica", "Flaccisagitta enflata"
      ) ~ "Molluscs & Others",

      # anything not matched above
      TRUE ~ "Unassigned"
    )
  )

#calculating abundance

library(dplyr)

zoop_fg_region <- zoop_fg |>
  group_by(region, sample_date, functional_group) |>
  summarise(total_abundance = sum(orgs, na.rm = TRUE), .groups = "drop")

library(ggplot2)
library(dplyr)

#Plot for Bowen
ggplot(
  zoop_fg_region |> filter(region == "Bowen"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Bowen",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Plot for Mackay
ggplot(
  zoop_fg_region |> filter(region == "Mackay"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Mackay",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Plot for Mackay
ggplot(
  zoop_fg_region |> filter(region == "Weipa"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Weipa",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))




```

# Adding functional group column to the dataset(second go)

```{r}
zoop_fg <- zoop |>
  mutate(
    functional_group = case_when(
      # 1. Copepods
      taxa %in% c(
        "Acartia pacifica", "Acrocalanus gibber", "Calanopia elliptica",
        "Centropages furcatus", "Farranula sp", "Farranula spp",
        "Microsetella rosea", "Oncaea venusta", "Oithona sp",
        "Pseudevadne sp", "Evadne spp"
      ) ~ "Copepods",

      # 2. Other Crustaceans
      taxa %in% c(
        "Portunidae", "Penaeus spp", "Penaeus sp",
        "Porcellanidae sp", "Porcellanidae spp",
        "Gammaridea", "Isopoda",
        "Caprella sp", "Caprella spp",
        "Bathyporeia sp", "Bathyporeia spp",
        "Stomatopoda", "Astacidea", "Panulirus sp",
        "Thecostraca", "Lucifer penicillifer"
      ) ~ "Other Crustaceans",

      # 3. Gelatinous & Others (merged)
      taxa %in% c(
        "Salpa sp", "Salpa spp", "Thalia sp",
        "Bolinopsis sp", "Doliolum sp", "Siphonophorae",
        "Oikopleura dioica", "Flaccisagitta enflata",
        "Cephalapoda", "Gastropoda"
      ) ~ "Gelatinous & Others",

      # 4. Larval Forms
      taxa %in% c(
        "Larval fish & eggs", "Polychaete", "Polychaeta",
        "Polycheate", "Cnidarian larvae", "Echinoidea"
      ) ~ "Larval Forms",

       # 5. Protists (Microzooplankton)
      taxa %in% c(
        "Acanthometra sp", "Acanthometra spp",
        "Dictyocysta sp", "Dictyocysta spp",
        "Favella serrata",
        "Tintinnopsis sp", "Tintinnopsis spp"
      ) ~ "Protists (Microzooplankton)",

      # anything not matched above
      TRUE ~ "Unassigned"
    )
  )

#calculating abundance

library(dplyr)

zoop_fg_region <- zoop_fg |>
  group_by(region, sample_date, functional_group) |>
  summarise(total_abundance = sum(orgs, na.rm = TRUE), .groups = "drop")

library(ggplot2)
library(dplyr)

#Plot for Bowen
ggplot(
  zoop_fg_region |> filter(region == "Bowen"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Bowen",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Plot for Mackay
ggplot(
  zoop_fg_region |> filter(region == "Mackay"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Mackay",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Plot for Mackay
ggplot(
  zoop_fg_region |> filter(region == "Weipa"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Weipa",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

# Adding functional group column to the dataset(third go)

```{r}
library(dplyr)
library(ggplot2)

zoop_fg <- zoop |>
  mutate(
    functional_group = case_when(

      # 1. Copepods
      taxa %in% c(
        "Acartia pacifica", "Acrocalanus gibber", "Calanopia elliptica",
        "Centropages furcatus", "Farranula sp", "Farranula spp",
        "Microsetella rosea", "Oncaea venusta", "Oithona sp",
        "Pseudevadne sp", "Evadne spp"
      ) ~ "Copepods",

      # 2. Other Crustaceans
      taxa %in% c(
        "Portunidae", "Penaeus spp", "Penaeus sp",
        "Porcellanidae sp", "Porcellanidae spp",
        "Gammaridea", "Isopoda",
        "Caprella sp", "Caprella spp",
        "Bathyporeia sp", "Bathyporeia spp",
        "Stomatopoda", "Astacidea", "Panulirus sp",
        "Thecostraca", "Lucifer penicillifer"
      ) ~ "Other Crustaceans",

      # 3. Gelatinous & Others
      taxa %in% c(
        "Salpa sp", "Salpa spp", "Thalia sp",
        "Bolinopsis sp", "Doliolum sp", "Siphonophorae",
        "Oikopleura dioica", "Flaccisagitta enflata",
        "Cephalapoda", "Gastropoda"
      ) ~ "Gelatinous & Others",

      # 4. Small / Micro / Larval Forms (merged)
      taxa %in% c(
        "Larval fish & eggs",
        "Polychaete", "Polychaeta", "Polycheate",
        "Cnidarian larvae", "Echinoidea",
        "Acanthometra sp", "Acanthometra spp",
        "Dictyocysta sp", "Dictyocysta spp",
        "Favella serrata",
        "Tintinnopsis sp", "Tintinnopsis spp"
      ) ~ "Small / Micro / Larval Forms",

      # anything not matched above
      TRUE ~ "Unassigned"
    )
  )

library(dplyr)

zoop_fg_region <- zoop_fg |>
  group_by(region, sample_date, functional_group) |>
  summarise(total_abundance = sum(orgs, na.rm = TRUE), .groups = "drop")

#for reducing y axis length
bowen_data <- zoop_fg_region |> filter(region == "Bowen")
ymax_bowen <- max(bowen_data$total_abundance, na.rm = TRUE) * 1.2

#Plot for Bowen
ggplot(
  zoop_fg_region |> filter(region == "Bowen"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Bowen",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  scale_y_continuous(limits = c(0, ymax_bowen)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#for reducing y axis length
mackay_data <- zoop_fg_region |> filter(region == "Mackay")
ymax_mackay <- max(mackay_data$total_abundance, na.rm = TRUE) * 1.2
#Plot for Mackay
ggplot(
  zoop_fg_region |> filter(region == "Mackay"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Mackay",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  scale_y_continuous(limits = c(0, ymax_mackay)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
  

#Plot for weipa
ggplot(
  zoop_fg_region |> filter(region == "Weipa"),
  aes(x = sample_date,
      y = total_abundance,
      colour = functional_group,
      group = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title = "Zooplankton Functional Group Abundance Over Time — Weipa",
    x = "Date",
    y = "Total abundance (Orgs)",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


# region-wise functional group richness for zooplankton:
```{r}
library(dplyr)
library(ggplot2)

# --- assuming zoop_fg (with functional_group) is already created as in your code ---

# 1. Region-wise functional group RICHNESS
zoop_fg_region_rich <- zoop_fg |>
  filter(!is.na(taxa), taxa != "") |>
  group_by(region, sample_date, functional_group) |>
  summarise(
    richness = n_distinct(taxa),
    .groups  = "drop"
  )

# --------- PLOTS (one per region) ---------

## Bowen
ggplot(
  zoop_fg_region_rich |> filter(region == "Bowen"),
  aes(x = sample_date,
      y = richness,
      colour = functional_group,
      group  = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Zooplankton functional group richness over time — Bowen",
    x      = "Date",
    y      = "Number of taxa",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

## Mackay
ggplot(
  zoop_fg_region_rich |> filter(region == "Mackay"),
  aes(x = sample_date,
      y = richness,
      colour = functional_group,
      group  = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Zooplankton functional group richness over time — Mackay",
    x      = "Date",
    y      = "Number of taxa",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

## Weipa
ggplot(
  zoop_fg_region_rich |> filter(region == "Weipa"),
  aes(x = sample_date,
      y = richness,
      colour = functional_group,
      group  = functional_group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Zooplankton functional group richness over time — Weipa",
    x      = "Date",
    y      = "Number of taxa",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


# phyto functional group analysis
# Summarise phyto abundance by functional group, region, and date


```{r}
library(dplyr)

phyto_fg_region <- phyto |>
  group_by(region, sample_date, group) |>
  summarise(
    total_cells = sum(cell_count, na.rm = TRUE),
    .groups = "drop"
  )

# Region-wise time-series plots (separate graphs)
#Bowen
library(ggplot2)

ggplot(
  phyto_fg_region |> filter(region == "Bowen"),
  aes(x = sample_date,
      y = total_cells,
      colour = group,
      group = group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Phytoplankton functional group abundance over time — Bowen",
    x      = "Date",
    y      = "Total cell count",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Mackay

ggplot(
  phyto_fg_region |> filter(region == "Mackay"),
  aes(x = sample_date,
      y = total_cells,
      colour = group,
      group = group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Phytoplankton functional group abundance over time — Mackay",
    x      = "Date",
    y      = "Total cell count",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Weipa

ggplot(
  phyto_fg_region |> filter(region == "Weipa"),
  aes(x = sample_date,
      y = total_cells,
      colour = group,
      group = group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Phytoplankton functional group abundance over time — Weipa",
    x      = "Date",
    y      = "Total cell count",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


# Phytoplankton Functional Group Richness — Region-wise (Time-series)
```{r}
# Summarise richness by region, date, and functional group
library(dplyr)

phyto_fg_region_rich <- phyto |>
  filter(!is.na(taxa) & taxa != "") |>       # remove blanks
  group_by(region, sample_date, group) |>
  summarise(
    richness = n_distinct(taxa),
    .groups = "drop"
  )

# Plot region-wise time-series
# Bowen
library(ggplot2)

ggplot(
  phyto_fg_region_rich |> filter(region == "Bowen"),
  aes(x = sample_date,
      y = richness,
      colour = group,
      group = group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Phytoplankton Functional Group Richness Over Time — Bowen",
    x      = "Date",
    y      = "Number of taxa",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Mackay
ggplot(
  phyto_fg_region_rich |> filter(region == "Mackay"),
  aes(x = sample_date,
      y = richness,
      colour = group,
      group = group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Phytoplankton Functional Group Richness Over Time — Mackay",
    x      = "Date",
    y      = "Number of taxa",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Weipa
ggplot(
  phyto_fg_region_rich |> filter(region == "Weipa"),
  aes(x = sample_date,
      y = richness,
      colour = group,
      group = group)
) +
  geom_line() +
  geom_point() +
  labs(
    title  = "Phytoplankton Functional Group Richness Over Time — Weipa",
    x      = "Date",
    y      = "Number of taxa",
    colour = "Functional group"
  ) +
    scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```


# sitewise functional group timeline graphs (zoop)(abundance)

```{r}
#summarising the dataset
zoop_fg_site <- zoop_fg |>
  group_by(region, site_code, site_name, sample_date, functional_group) |>
  summarise(total_abundance = sum(orgs, na.rm = TRUE), .groups = "drop")

#creating function for sitewise timeline functional group graphs

plot_site_fg <- function(site_id) {
  ggplot(
    zoop_fg_site |> filter(site_code == site_id),
    aes(x = sample_date,
        y = total_abundance,
        colour = functional_group,
        group = functional_group)
  ) +
    geom_line() +
    geom_point() +
    labs(
      title = paste("Zooplankton Functional Group Abundance —", site_id),
      x = "Date",
      y = "Total abundance (Orgs)",
      colour = "Functional group"
    ) +
      scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

#Plotting all the sites

sites <- c(
  "AP_AMB1", "AP_AMB2", "AP_AMB3", "AP_AMB4", "AP_AMB5",
  "MKY_AMB1", "MKY_AMB10", "MKY_AMB11", "MKY_AMB12",
  "MKY_AMB2", "MKY_AMB3B", "MKY_AMB5", "MKY_AMB6B", "MKY_AMB8",
  "MKY_CAM1", "MKY_CAM2", "MKY_CAM3",
  "WP_AMB1", "WP_AMB2", "WP_AMB3", "WP_AMB4", "WP_AMB5"
)

# Run your plot function for every site automatically
for (s in sites) {
  print(paste("Plotting site:", s))
  print(plot_site_fg(s))
}


```

# Zooplankton Functional-Group Richness — Sitewise Timeline

```{r}
# Summarise richness
zoop_fg_rich_site <- zoop_fg |>
  filter(!is.na(taxa) & taxa != "") |>          # ensure taxa valid
  group_by(region, site_code, site_name, sample_date, functional_group) |>
  summarise(richness = n_distinct(taxa), .groups = "drop")

# Create the plotting function
plot_site_fg_rich <- function(site_id) {
  ggplot(
    zoop_fg_rich_site |> filter(site_code == site_id),
    aes(x = sample_date,
        y = richness,
        colour = functional_group,
        group = functional_group)
  ) +
    geom_line() +
    geom_point() +
    labs(
      title = paste("Zooplankton Functional Group Richness —", site_id),
      x = "Date",
      y = "Richness (Number of taxa)",
      colour = "Functional group"
    ) +
      scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

# Loop through all sites

sites <- c(
  "AP_AMB1", "AP_AMB2", "AP_AMB3", "AP_AMB4", "AP_AMB5",
  "MKY_AMB1", "MKY_AMB10", "MKY_AMB11", "MKY_AMB12",
  "MKY_AMB2", "MKY_AMB3B", "MKY_AMB5", "MKY_AMB6B", "MKY_AMB8",
  "MKY_CAM1", "MKY_CAM2", "MKY_CAM3",
  "WP_AMB1", "WP_AMB2", "WP_AMB3", "WP_AMB4", "WP_AMB5"
)

for (s in sites) {
  print(paste("Plotting richness for site:", s))
  print(plot_site_fg_rich(s))
}


```

# sitewise functional group timeline graphs (phyto)(abundance)

```{r}
# Summarise phytoplankton by site + functional group
library(dplyr)

phyto_fg_site <- phyto |>
  group_by(region, site_code, site_name, sample_date, group) |>
  summarise(
    total_cells = sum(cell_count, na.rm = TRUE),
    .groups = "drop"
  )

# Function to make site-wise functional group timelines

library(ggplot2)

plot_phyto_site_fg <- function(site_id) {
  ggplot(
    phyto_fg_site |> filter(site_code == site_id),
    aes(x = sample_date,
        y = total_cells,
        colour = group,
        group = group)
  ) +
    geom_line() +
    geom_point() +
    labs(
      title = paste("Phytoplankton Functional Group Abundance —", site_id),
      x = "Date",
      y = "Total cell count",
      colour = "Functional group"
    ) +
      scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

# Get all sites & plot them

phyto_sites <- sort(unique(phyto_fg_site$site_code))

for (s in phyto_sites) {
  print(paste("Plotting site:", s))
  print(plot_phyto_site_fg(s))
}

```

# site-wise functional group richness time series for phytoplankton.

```{r}
library(dplyr)
library(ggplot2)

#---- 1. Summarise phytoplankton richness by site + functional group ----
# (assuming your taxonomic column is called `taxa` and functional group is `group`)

phyto_fg_site_rich <- phyto |>
  filter(!is.na(taxa), taxa != "") |>          # keep only real taxa
  group_by(region, site_code, site_name, sample_date, group) |>
  summarise(
    richness = n_distinct(taxa),              # number of unique taxa in that FG
    .groups = "drop"
  )

#---- 2. Function to make site-wise functional group richness timelines ----

plot_phyto_site_fg_rich <- function(site_id) {
  ggplot(
    phyto_fg_site_rich |> filter(site_code == site_id),
    aes(x = sample_date,
        y = richness,
        colour = group,
        group = group)
  ) +
    geom_line() +
    geom_point() +
    labs(
      title  = paste("Phytoplankton Functional Group Richness —", site_id),
      x      = "Date",
      y      = "Number of taxa",
      colour = "Functional group"
    ) +
      scale_x_date(
  limits = as.Date(c("2018-01-01", "2020-12-31")),
  date_breaks = "3 months",
  date_labels = "%Y-%m") + 
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

#---- 3. Get all sites & plot them ----

phyto_sites <- sort(unique(phyto_fg_site_rich$site_code))

for (s in phyto_sites) {
  print(paste("Plotting site:", s))
  print(plot_phyto_site_fg_rich(s))
}

```


# Comparing WaterQuality Data
# processing physiochem data 
```{r}
# Which sheet to use & how to read both in R

library(readxl)
library(dplyr)

physio_path <- "data/Physiochem Database tables_all_rows(20240902_1226).xlsx"

field_obs  <- read_excel(physio_path, sheet = "Field_obs(20240902_1226)")
field_meas <- read_excel(physio_path, sheet = "Field_meas(20240902_1226)")

# Combine the sheets & add region

library(dplyr)

# 1. surface-only physio measurements
meas_surface <- field_meas |>
  filter(Category == "Surface") |>
  select(Site_code, Date, Temp, EC_mScm, DO_mgL)  # adjust names if slightly different

# 2. field observations with Secchi
obs_light <- field_obs |>
  select(Site_code, Date, Secchi)  # keep Secchi as your light variable

#converting both dataset dates into character
meas_surface <- meas_surface |> 
  mutate(Date = as.Date(Date))

obs_light <- obs_light |> 
  mutate(Date = as.Date(Date), 
  Secchi = as.numeric(Secchi))

# 3. join them together by site + date
physio_join <- meas_surface |>
  left_join(obs_light, by = c("Site_code", "Date"))

# 4. get region lookup from your plankton data
site_regions <- zoop |>
  distinct(site_code, region)

# 5. add region
physio_join <- physio_join |>
  left_join(site_regions, by = c("Site_code" = "site_code"))

# Summarise region-wise over time
physio_region <- physio_join |>
  group_by(region, Date) |>
  summarise(
    temp_c       = mean(Temp,      na.rm = TRUE),
    salinity_psu = mean(EC_mScm,  na.rm = TRUE),   # or EC_mScm if that's what you want
    secchi_m     = mean(Secchi,    na.rm = TRUE),
    .groups = "drop"
  )

# Make a 3-panel region-wise timeline (light, temp, salinity)


library(dplyr)
library(tidyr)
library(ggplot2)

# 1. Filter to 2018–2020 and the three regions
physio_region_18_20 <- physio_region |>
  filter(
    Date >= as.Date("2018-01-01"),
    Date <= as.Date("2020-12-31"),
    region %in% c("Bowen", "Mackay", "Weipa")
  )

# 2. Long format for plotting (one column for parameter, one for value)
physio_region_long <- physio_region_18_20 |>
  pivot_longer(
    cols = c(secchi_m, temp_c, salinity_psu),
    names_to = "parameter",
    values_to = "value"
  )

# 3. Function to plot ONE region at a time
plot_physio_region <- function(reg_name) {
  ggplot(
    physio_region_long |> filter(region == reg_name),
    aes(x = Date, y = value, colour = parameter, group = parameter)
  ) +
    geom_line() +
    geom_point() +
    facet_wrap(~ parameter, scales = "free_y", ncol = 1) +
    labs(
      title = paste("Water quality over time —", reg_name),
      x = "Date",
      y = "Value",
      colour = "Parameter"
    ) +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

# 4. Make the three separate graphs
plot_physio_region("Bowen")
plot_physio_region("Mackay")
plot_physio_region("Weipa")

```

# Comparing DO to phyto and zoop total abundance and richness

```{r}
# Prepare DO time-series by region
library(dplyr)
library(tidyr)
library(ggplot2)
library(rlang)   # for sym()

# 1. Region–date summary of DO (mean over depths per day)
do_region_daily <- physio_join |>
  group_by(region, Date) |>
  summarise(DO_mgL = mean(DO_mgL, na.rm = TRUE), .groups = "drop")

# Join DO with your zoop + phyto region tables

# Match column name to join by date
zoop_do_region <- zoop_region_daily |>
  rename(Date = sample_date) |>
  left_join(do_region_daily, by = c("region", "Date"))

phyto_do_region <- phyto_region_daily |>
  rename(Date = sample_date) |>
  left_join(do_region_daily, by = c("region", "Date"))

# Helper function: time-series of DO + one plankton metric

plot_do_timeseries <- function(region_name,
                               df,
                               response_col,   # e.g. "zoop_total"
                               response_label, # pretty name for strip
                               title_suffix) { # e.g. "zooplankton abundance"
  
  long_df <- df |>
    filter(region == region_name) |>
    select(Date, DO_mgL, !!sym(response_col)) |>
    rename(Response = !!sym(response_col)) |>
    pivot_longer(
      cols = c(DO_mgL, Response),
      names_to  = "parameter",
      values_to = "value"
    ) |>
    mutate(
      parameter = dplyr::recode(
        parameter,
        DO_mgL   = "Dissolved oxygen (mg/L)",
        Response = response_label
      )
    )
  
  ggplot(long_df, aes(x = Date, y = value)) +
    geom_line() +
    geom_point(size = 0.8) +
    facet_wrap(~ parameter, ncol = 1, scales = "free_y") +
    labs(
      title = paste(region_name, "— DO vs", title_suffix),
      x = "Date",
      y = "Value"
    ) +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}


# Generate the 12 plots
library(dplyr)
library(tidyr)
library(ggplot2)
# Bowen
# 1. DO vs zoop abundance
plot_do_timeseries("Bowen",
                   zoop_do_region,
                   response_col   = "zoop_total",
                   response_label = "Zooplankton abundance (orgs)",
                   title_suffix   = "zooplankton abundance")

# 2. DO vs zoop richness
plot_do_timeseries("Bowen",
                   zoop_do_region,
                   response_col   = "zoop_richness",
                   response_label = "Zooplankton richness (taxa)",
                   title_suffix   = "zooplankton richness")

# 3. DO vs phyto abundance
plot_do_timeseries("Bowen",
                   phyto_do_region,
                   response_col   = "phyto_total",
                   response_label = "Phytoplankton abundance (cells)",
                   title_suffix   = "phytoplankton abundance")

# 4. DO vs phyto richness
plot_do_timeseries("Bowen",
                   phyto_do_region,
                   response_col   = "phyto_richness",
                   response_label = "Phytoplankton richness (taxa)",
                   title_suffix   = "phytoplankton richness")

# Mackay
plot_do_timeseries("Mackay", zoop_do_region,
                   "zoop_total",   "Zooplankton abundance (orgs)",
                   "zooplankton abundance")

plot_do_timeseries("Mackay", zoop_do_region,
                   "zoop_richness","Zooplankton richness (taxa)",
                   "zooplankton richness")

plot_do_timeseries("Mackay", phyto_do_region,
                   "phyto_total",  "Phytoplankton abundance (cells)",
                   "phytoplankton abundance")

plot_do_timeseries("Mackay", phyto_do_region,
                   "phyto_richness","Phytoplankton richness (taxa)",
                   "phytoplankton richness")

# Weipa

plot_do_timeseries("Weipa", zoop_do_region,
                   "zoop_total",   "Zooplankton abundance (orgs)",
                   "zooplankton abundance")

plot_do_timeseries("Weipa", zoop_do_region,
                   "zoop_richness","Zooplankton richness (taxa)",
                   "zooplankton richness")

plot_do_timeseries("Weipa", phyto_do_region,
                   "phyto_total",  "Phytoplankton abundance (cells)",
                   "phytoplankton abundance")

plot_do_timeseries("Weipa", phyto_do_region,
                   "phyto_richness","Phytoplankton richness (taxa)",
                   "phytoplankton richness")

# correct this code.
```
